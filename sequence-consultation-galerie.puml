@startuml Séquence Consultation Galerie

!define PRIMARY_COLOR #4ECDC4
!define SECONDARY_COLOR #FF6B6B

skinparam backgroundColor #FAFAFA
skinparam sequenceParticipantBackgroundColor PRIMARY_COLOR

title Diagramme de Séquence - Consultation de la Galerie

actor Visiteur as visitor
participant "Page\nGallery" as page
participant "API\nBackend" as api
participant "Controller\nArtwork" as controller
database "MongoDB" as db

visitor -> page : Accède à /gallery
activate page

page -> api : GET /api/artworks
activate api

api -> controller : getAllArtworks(req, res)
activate controller

alt Filtrage par catégorie
    visitor -> page : Sélectionne catégorie
    page -> api : GET /api/artworks?category={categoryId}
    api -> controller : getArtworksByCategory(req, res)
end

controller -> db : Find artworks\n.populate('category')\n.populate('owner', 'username')
activate db

alt Aucune œuvre trouvée
    db --> controller : []
    controller --> api : 200 OK\n{artworks: []}
    api --> page : []
    page --> visitor : "Aucune œuvre disponible"
else Œuvres trouvées
    db --> controller : [artworks...]
    deactivate db
    
    controller --> api : 200 OK\n{artworks: [...]}
    deactivate controller
    
    api --> page : {artworks: [...]}
    deactivate api
    
    page -> page : Affiche grille d'œuvres\n(cartes avec images)
    page --> visitor : Galerie affichée
    
    alt Visiteur clique sur une œuvre
        visitor -> page : Clique sur œuvre
        page -> api : GET /api/artworks/{id}
        activate api
        
        api -> controller : getArtworkById(req, res)
        activate controller
        
        controller -> db : findById(id)\n.populate('category')\n.populate('owner')
        activate db
        
        alt Œuvre non trouvée
            db --> controller : null
            controller --> api : 404 Not Found
            api --> page : Œuvre introuvable
            page --> visitor : "Œuvre non trouvée"
        else Œuvre trouvée
            db --> controller : artwork
            deactivate db
            
            controller --> api : 200 OK\n{artwork}
            deactivate controller
            
            api --> page : {artwork}
            deactivate api
            
            page -> page : Affiche modal/page détails\n(image HD, infos complètes)
            page --> visitor : Détails de l'œuvre
        end
    end
end

deactivate page

note right of page
    La galerie peut être filtrée par:
    - Catégorie
    - Artiste
    - Année
    - Recherche texte
end note

@enduml
